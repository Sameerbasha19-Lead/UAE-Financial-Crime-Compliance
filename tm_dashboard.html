<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AML Transaction Monitoring Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-6">

    <!-- Top Navigation -->
    <div class="flex justify-between items-center mb-8 border-b border-gray-700 pb-4">
        <div>
            <h1 class="text-2xl font-bold text-blue-400">üõ°Ô∏è AML Watchtower v2.0</h1>
            <p class="text-xs text-gray-500">Real-time Transaction Monitoring & Sanctions Screening</p>
        </div>
        <div class="text-right">
            <div class="text-xs text-gray-400">SYSTEM STATUS</div>
            <div class="text-green-500 font-mono font-bold">‚óè ONLINE - MONITORING ACTIVE</div>
        </div>
    </div>

    <!-- Main Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Panel 1: The Live Feed (Input) -->
        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700 shadow-lg">
            <h2 class="text-sm font-bold text-gray-400 mb-4 uppercase tracking-wider">üì° Live Transaction Feed</h2>
            <div class="h-96 overflow-y-auto space-y-2 pr-2" id="transactionFeed">
                <!-- Transactions will appear here dynamically -->
                <p class="text-xs text-gray-600 text-center mt-10">Waiting for data stream...</p>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-700">
                <button onclick="runSimulation()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded transition duration-200 shadow-lg flex justify-center items-center">
                    <span class="mr-2">‚ñ∂</span> Run Batch Simulation (100 Txn)
                </button>
            </div>
        </div>

        <!-- Panel 2: The Rules Engine (Logic) -->
        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700 shadow-lg">
            <h2 class="text-sm font-bold text-gray-400 mb-4 uppercase tracking-wider">‚öôÔ∏è Active Detection Rules</h2>
            
            <div class="space-y-3">
                <!-- Rule 1 -->
                <div class="bg-gray-700 p-3 rounded border-l-4 border-red-500">
                    <div class="flex justify-between">
                        <span class="text-sm font-bold text-red-300">R01: High-Risk Jurisdiction</span>
                        <span class="text-xs bg-red-900 text-red-100 px-2 py-0.5 rounded">CRITICAL</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">Flag any transfer to/from FATF Blacklisted countries (e.g., North Korea, Iran).</p>
                </div>

                <!-- Rule 2 -->
                <div class="bg-gray-700 p-3 rounded border-l-4 border-orange-500">
                    <div class="flex justify-between">
                        <span class="text-sm font-bold text-orange-300">R02: Structuring (Smurfing)</span>
                        <span class="text-xs bg-orange-900 text-orange-100 px-2 py-0.5 rounded">HIGH</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">Detect multiple cash deposits &lt; AED 50,000 within 24 hours.</p>
                </div>

                <!-- Rule 3 -->
                <div class="bg-gray-700 p-3 rounded border-l-4 border-yellow-500">
                    <div class="flex justify-between">
                        <span class="text-sm font-bold text-yellow-300">R03: Velocity Check</span>
                        <span class="text-xs bg-yellow-900 text-yellow-100 px-2 py-0.5 rounded">MEDIUM</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">More than 5 transactions out in &lt; 60 minutes.</p>
                </div>
            </div>

            <div class="mt-6">
                <h3 class="text-xs text-gray-500 mb-2 uppercase">Detection Statistics</h3>
                <canvas id="alertChart" height="150"></canvas>
            </div>
        </div>

        <!-- Panel 3: Alert Adjudication (The Output) -->
        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700 shadow-lg">
            <h2 class="text-sm font-bold text-gray-400 mb-4 uppercase tracking-wider">üö® Generated Alerts Queue</h2>
            <div class="h-full overflow-y-auto pr-2" id="alertsQueue">
                <p class="text-xs text-gray-600 text-center mt-10">No active alerts.</p>
            </div>
        </div>

    </div>

    <script>
        // Mock Data for Simulation
        const names = ["Ahmed Trading LLC", "John Smith", "Global Imports FZE", "Unknown Entity", "Sarah Jones", "Tech Solutions Ltd"];
        const countries = ["UAE", "UAE", "UAE", "USA", "UK", "India", "North Korea", "Iran", "Germany"];
        const types = ["Wire Transfer", "Cash Deposit", "ATM Withdrawal", "Cheque Clearing"];
        
        let alertCount = { R01: 0, R02: 0, R03: 0 };
        let chartInstance = null;

        function initChart() {
            const ctx = document.getElementById('alertChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Sanctions (R01)', 'Structuring (R02)', 'Velocity (R03)'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#ef4444', '#f97316', '#eab308'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
        }

        function runSimulation() {
            const feed = document.getElementById('transactionFeed');
            const queue = document.getElementById('alertsQueue');
            feed.innerHTML = "";
            queue.innerHTML = "";
            alertCount = { R01: 0, R02: 0, R03: 0 };
            
            let delay = 0;

            // Generate 20 random transactions
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const tx = generateTransaction();
                    
                    // Display in Feed
                    const div = document.createElement('div');
                    div.className = "text-xs p-2 rounded bg-gray-700 border border-gray-600 font-mono flex justify-between";
                    div.innerHTML = `<span>${tx.id}</span> <span class="text-blue-300">${tx.amount} AED</span>`;
                    feed.prepend(div);

                    // Check Logic
                    checkRules(tx, queue);
                    
                }, delay);
                delay += 200; // Stagger effect
            }
        }

        function generateTransaction() {
            return {
                id: "TXN-" + Math.floor(Math.random() * 90000 + 10000),
                name: names[Math.floor(Math.random() * names.length)],
                country: countries[Math.floor(Math.random() * countries.length)],
                amount: Math.floor(Math.random() * 60000 + 1000), // Max 61,000 AED
                type: types[Math.floor(Math.random() * types.length)]
            };
        }

        function checkRules(tx, queue) {
            let triggered = false;
            let rule = "";
            let color = "";

            // Logic R01: Sanctions
            if (tx.country === "North Korea" || tx.country === "Iran") {
                triggered = true;
                rule = "R01: SANCTION HIT";
                color = "border-red-500 bg-red-900/20";
                alertCount.R01++;
            }
            // Logic R02: Structuring (Cash between 40k and 50k)
            else if (tx.type === "Cash Deposit" && tx.amount > 40000 && tx.amount < 50000) {
                triggered = true;
                rule = "R02: SUSPECTED STRUCTURING";
                color = "border-orange-500 bg-orange-900/20";
                alertCount.R02++;
            }
            // Logic R03: Random Velocity (Simulated)
            else if (Math.random() > 0.85) {
                triggered = true;
                rule = "R03: VELOCITY SPIKE";
                color = "border-yellow-500 bg-yellow-900/20";
                alertCount.R03++;
            }

            if (triggered) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `p-3 mb-2 rounded border-l-4 ${color} animate-pulse`;
                alertDiv.innerHTML = `
                    <div class="flex justify-between mb-1">
                        <span class="font-bold text-xs text-gray-200">${rule}</span>
                        <span class="text-[10px] text-gray-400">PENDING</span>
                    </div>
                    <div class="text-xs text-gray-400">
                        <p>Entity: <span class="text-gray-200">${tx.name}</span></p>
                        <p>Amt: <span class="text-gray-200">${tx.amount} AED</span> (${tx.type})</p>
                        <p>Jurisdiction: ${tx.country}</p>
                    </div>
                    <div class="mt-2 flex gap-2">
                        <button class="flex-1 bg-green-700 hover:bg-green-600 text-white text-[10px] py-1 rounded">False Positive</button>
                        <button class="flex-1 bg-red-700 hover:bg-red-600 text-white text-[10px] py-1 rounded">Escalate to SAR</button>
                    </div>
                `;
                queue.prepend(alertDiv);
                updateChart();
            }
        }

        function updateChart() {
            if(chartInstance) {
                chartInstance.data.datasets[0].data = [alertCount.R01, alertCount.R02, alertCount.R03];
                chartInstance.update();
            }
        }

        initChart();
    </script>
</body>
</html>